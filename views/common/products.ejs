<!-- this file should read the values from the data.json file into li in loop (add a new product to the page after the admin mode) -->
<br>


<div class="container">
    <div class="container3">
        <div class="container2">


            <div class="container">
                <div class="search-container">
                    <input type="text" class="form-control me-2" id="searchQuery" placeholder="Search product">
                    <button class="btn btn-primary search-btn" role="button">Search</button>
                </div>
            </div>



            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto2">
                        <li class="nav-item2">
                            <a class="nav-link2" href="#" data-category="All"><span class="categories">All</span></a>
                        </li>
                        <li class="nav-item2">
                            <a class="nav-link2" href="#" data-category="Candles"><span
                                    class="categories">Candles</span></a>
                            <select class="brand-selector">
                                <option value="All" disabled selected>Brands List</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                            </select>
                        </li>
                        <li class="nav-item2">
                            <a class="nav-link2" href="#" data-category="Soaps"><span
                                    class="categories">Soaps</span></a>
                            <select class="brand-selector">
                                <option value="All" disabled selected>Brands List</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                            </select>
                        </li>
                        <li class="nav-item2">
                            <a class="nav-link2" href="#" data-category="Fragrance"><span
                                    class="categories">Fragrance</span></a>
                            <select class="brand-selector">
                                <option value="All" disabled selected>Brands List</option>
                                <option value="G">G</option>
                                <option value="H">H</option>
                                <option value="I">I</option>
                            </select>
                        </li>
                        <li class="nav-item2">
                            <a class="nav-link2" href="#" data-category="Mixed"><span
                                    class="categories">Other</span></a>
                            <select class="brand-selector">
                                <option value="All" disabled selected>Brands List</option>
                                <option value="J">J</option>
                                <option value="K">K</option>
                                <option value="L">L</option>
                            </select>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="container">
                <div class="price-range-selector">
                    <label for="price-range-select">Select Price Range</label>
                    <select id="price-range-select">
                        <option value="0">All</option>
                        <option value="10">Max $5</option>
                        <option value="10">Max $10</option>
                        <option value="20">Max $20</option>
                        <option value="50">Max $50</option>
                        <option value="100">Max $100</option>
                        <option value="500">Max $500</option>
                        <option value="1000">Max $1000</option>
                    </select>
                </div>
            </div>
        </div>







        <br>
        <br><br>
        <div class="container4">
            <div class="inside">
                <% products.forEach((product)=> { %>
                    <div class="entry" data-product-id="<%= product._id %>">
                        <div class="product-info">
                            <img class="product-image" src="<%= product.image %>" alt="Product Image">
                            <div class="product-details">
                                <h5 class="product-title">
                                    <%= product.title %>
                                </h5>
                                <p class="product-category">Category: <%= product.category %>
                                </p>
                                <p class="product-brand">Brand: <%= product.brand %>
                                </p>
                                <p class="product-price">Price: $<%= product.price %>
                                </p>
                            </div>
                        </div>
                        <div class="product-control">
                            <button class="btn btn-primary decrease-quantity" data-product-id="<%= product._id %>"
                                data-title="<%= product.title %>" data-category="<%= product.category %>"
                                data-description="<%= product.description %>" data-image="<%= product.image %>"
                                data-quantity="<%= product.quantity %>" data-price="<%= product.price %>">-</button>

                            <span class="quantity">
                                <%= product.quantity %>
                            </span>

                            <button class="btn btn-primary increase-quantity" data-product-id="<%= product._id %>"
                                data-title="<%= product.title %>" data-category="<%= product.category %>"
                                data-description="<%= product.description %>" data-image="<%= product.image %>"
                                data-quantity="<%= product.quantity %>" data-price="<%= product.price %>">+</button>

                            <span class="payment" data-product-id="<%= product._id %>" data-title="<%= product.title %>"
                                data-category="<%= product.category %>" data-description="<%= product.description %>"
                                data-image="<%= product.image %>" data-quantity="<%= product.quantity %>"
                                data-price="<%= product.price %>">Total: $
                                <%= product.payment %>
                            </span>
                        </div>
                        <a class="btn btn-primary add-to-cart" href="/" role="button"
                            data-product-id="<%= product._id %>" data-title="<%= product.title %>"
                            data-category="<%= product.category %>" data-description="<%= product.description %>"
                            data-image="<%= product.image %>" data-price="<%= product.price %>"
                            data-payment="<%= product.payment %>">Add to cart</a>
                    </div>
                    <% }); %>
            </div>

        </div>

    </div>

</div>




<%- include('cart-sum')%>
    <%- include('cart-control')%>





        <script>
            function filterCategory() {
                const categoryOption = document.querySelectorAll('.nav-link2');
                const productEntries = document.querySelectorAll('.entry');
                const priceRange = document.getElementById('price-range-select');
                const brandsOption = document.querySelectorAll('.brand-selector');

                categoryOption.forEach((entry) => {  // filter the categories for each click
                    entry.addEventListener('click', (event) => {
                        event.preventDefault();
                        const selectedCategory = entry.getAttribute('data-category');

                        productEntries.forEach((entry) => {
                            entry.style.display = 'block';
                            const category = entry.querySelector('.product-category').innerText.split(': ')[1]; // take the second key without the ': '

                            if (selectedCategory === 'All' || selectedCategory === category) {
                                entry.style.display = 'block';
                            }
                            else {
                                entry.style.display = 'none';
                            }
                        });

                        priceRange.value = '0'; // set price range selector back to 'All'

                        brandsOption.forEach((selector) => { // to set the brand selector back to All Brands
                            selector.value = 'All';
                        });
                    });
                });

                brandsOption.forEach((selector) => {
                    selector.addEventListener('change', () => {
                        const selectedBrand = selector.value;

                        productEntries.forEach((entry) => {
                            entry.style.display = 'block';
                            const brand = entry.querySelector('.product-brand').innerText.split(': ')[1]; // get the brand value in the second key

                            if (selectedBrand !== 'All' && selectedBrand !== brand) {
                                entry.style.display = 'none'; // the the nunwanted brands-products
                            }
                        });
                    });
                });
            }

            function filterPrice() {
                const priceRange = document.getElementById('price-range-select');
                const productEntries = document.querySelectorAll('.entry');

                priceRange.addEventListener('change', (event) => {
                    const maxPrice = parseInt(event.target.value);

                    productEntries.forEach((entry) => {
                        entry.style.display = 'block';
                        const price = parseInt(entry.querySelector('.product-price').innerText.split('$')[1]); // take the second key without the '$'

                        if (maxPrice === 0 || price <= maxPrice) {
                            entry.style.display = 'block';
                        }
                        else {
                            entry.style.display = 'none'; // hide the unwanted products
                        }
                    });
                });
            }



            function searchFilter() {

                const searchInput = document.getElementById('searchQuery'); // the searchQuery remebers the search hisotry
                const searchButton = document.querySelector('.search-btn');
                const productEntries = document.querySelectorAll('.entry');

                searchButton.addEventListener('click', () => {
                    const search = searchInput.value.toUpperCase().trim(); // to remove spaces

                    productEntries.forEach((entry) => {
                        const productTitle = entry.querySelector('.product-title').textContent.toUpperCase().trim(); // to remove spaces

                        if (productTitle.includes(search)) { // if any characters from the search ore contained in the productTitle
                            entry.style.display = 'block';
                        }
                        else {
                            entry.style.display = 'none'; // don't show the unwanted entries
                        }
                    });
                });

            }


            searchFilter(); // the function to find the search input
            filterCategory(); //  the function to filter the categores
            filterPrice();  //  the function to filter the prices


        </script>